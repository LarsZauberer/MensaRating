\chapter{Spezifikationen}

\section{Menus} \label{spez:Menus}

Menus sind Objekte, welche in der Datenbank als \code{Menu}-Objekt gespeichert
werden (siehe \ref{fig:DB}, \ref{code:core.models.py}). Jedes \code{Menu} ist
ein Vorkommen eines Gerichts. Um die verschiedenen Vorkommen der
\code{Menu}-Objekte zu gruppieren existiert das \code{MenuType}-Objekt. Als
Gruppierungsattribut dient der Name des Gerichts.

Die Menus werden von der Mensa-Website gescraped. Die Synchronization (siehe
\ref{spez:Webscraper}) findet bei jedem Aufruf einer der Seiten statt.

Nur wenn das heutige Datum mit dem Datum des Menus übereinstimmt, ist es möglich
Dinge zu posten (siehe \ref{spez:Posts}), das Menu zu Bewerten (siehe
\ref{spez:Rating}) und die Posts zu liken (siehe \ref{spez:Liking}).

\section{Webscraper} \label{spez:Webscraper}

Der Webscraper ist ein standalone Python Script (siehe
\ref{code:core.webscraper.py}). Der Webscraper stellt mit der Library
\code{requests} Anfragen an die Webseite
\url{https://neuekanti.sv-restaurant.ch/de/menuplan/}. Zuerst werden die Tages
und Datumsdaten von der Seite geladen. Danach werden die Gerichte (Name,
Beschreibung, Vegan/Vegetarisch) gescraped.

Das Script wird bei jedem Aufruf von der Webseite ausgeführt. Nach dem Scraping
der Daten werden die Daten mit der Datenbank (siehe \ref{fig:DB}) verglichen.
Ist das \code{Menu}-Objekt (siehe \ref{spez:Menus}) noch nicht in der Datenbank,
dann wird nach einem zugehörigen \code{MenuType} (siehe \ref{spez:Menus})
gesucht. Wenn dieses nicht existiert, dann werden beide Objekte einfach mit den
Daten erstellt. Sonst wird nur das \code{Menu}-Objekt erstellt.

\begin{lstlisting}
    data = scrape_data()
    menus = get_menus_from_db()
    for menu in data:
        if menu not in menus:
            menu_type = get_menu_type(menu)
            if menu_type is None:
                menu_type = create_menu_type(menu)
            create_menu(menu, menu_type)
\end{lstlisting}

\section{Bilder Gallerie} \label{spez:Gallerie}

Die Bildergallerie ein Frontend Feature. Die Bildergallerie wurde von dem
Tutorial auf dieser Seite nachgemacht:
\url{https://www.w3schools.com/howto/howto_js_slideshow.asp}. Die Bildergallerie
wird gebraucht, damit die Images (siehe \ref{spez:Images}) von den Menus (siehe
\ref{spez:Menus}) angezeigt werden können.

Im Javascript werden die verschiedenen Bilder in einem Array gespeichert. Nur
das aktive Bild bekommt den style \code{display: block}. Die anderen Bilder
haben \code{display: none}.

Wenn es noch keine Bilder auf dem Menu gibt, dann wird ein default Bild
angezeigt.

Da Bilder einerseits Hoch oder Querformat sein können, gibt es einen Check auf
die Orientierung gibt. Wenn das Bild Hochformat ist, dann wird es im css anders
behandelt.

\section{Posts} \label{spez:Posts}

Posts sind verschiedene Objekte in der Datenbank (siehe \ref{fig:DB}). Es gibt
kein übergeordnetes Objekt Posts. Posts sind Images (siehe \ref{spez:Images})
und Reviews (siehe \ref{spez:Reviews}).

\subsection{Images} \label{spez:Images}

Es gibt ein \code{Image}-Objekt in der Datenbank (siehe \ref{fig:DB} und
\ref{code:core.models.py}). Die Image Datei wird nicht in der Datenbank
gespeichert. In der Datenbank wird nur die Referenz dort hin gespeichert.

Wenn das Image auf der öffentlichen Webseite (siehe \ref{spez:Deployment}), dann
wird das Image nicht auf dem eigentlichen Server gespeichert, sondern auf einem
Google Drive. Das wird gemacht, da der Server Container keinen persistant
Storage hat.

\subsection{Reviews} \label{spez:Reviews}

Es gibt ein \code{Review}-Objekt in der Datenbank (siehe \ref{fig:DB} und
\ref{code:core.models.py}). Ein Review ist ein Kommentar, welcher auf der
Webseite angezeigt werden kann.

\subsection{Liking} \label{spez:Liking}

Man kann die Posts liken. Dabei wird der Like Counter in der Datenbank erhöht.
Ob der User bereits geliked hat, wird im Javascript Localstorage gespeichert.
Das wird gemacht, damit die Datenbank nicht zu viele Einträge bekommt.

\section{Rating} \label{spez:Rating}

Ein Rating ist ein Objekt in der Datenbank (siehe \ref{fig:DB} und
\ref{code:core.models.py}). Ein Rating ist eine Bewertung für ein Menu-Objekt
(siehe \ref{spez:Menus}). Ein Rating hat einen Wert zwischen 1 und 5.

\section{Statistik Filter und Sortierung} \label{spez:Statistik}



\section{Account System} \label{spez:Account}

Django hat ein eingebautes Account System. Dieses Accountsystem wird in die
Webseite integriert (siehe \ref{code:users.views.py}). Es gibt die Funktionen:
\begin{itemize}
    \item register
    \item login
    \item logout
    \item password-reset
    \item password-reset-done
    \item password-reset-confirm
    \item password-reset-complete
\end{itemize}

Beim Registrieren wird ein \code{User}-Objekt in der Datenbank (nicht in der
models.py Datei) erstellt. Danach auch ein \code{Profil}-Objekt (siehe
\ref{code:core.models.py} und \ref{fig:DB}). Beim Registrieren gibt es auch noch
eine ReCaptcha überprüfung, damit die Datenbank nicht zugespammt wird. Es gibt
keine Email Verifikation.

Login und Logout verwalten die Session mit den Django implementierten
Funktionen.

Die Funktion des Password-reset funktioniert über die angegebene Email Adresse.
Es wird ein sicherer Token für den Passwordreset an die Email Adresse gesendet.
Das Email Adresse wird mit einem Gmail Account gesendet.

\section{Mobile Responsiveness} \label{spez:Mobile}

Milestone 1 noch nicht implementiert.

\section{Punktesystem (Karma)} \label{spez:Karma}

Die Punkte, auch Karma genannt, werden in \code{Profil}-Objekt (siehe
\ref{fig:DB} und \ref{code:core.models.py}) gespeichert.

Man kann Punkte für das Posten von Posts (siehe \ref{spez:Posts}) und für das
Likes auf den eigenen Posts bekommen.

Mit den Punkten kann man Achievements erreichen (siehe \ref{spez:Badges}).

\section{Achievements (Badges)} \label{spez:Badges}

Die Achievements werden in \code{Badge}-Objekt (siehe \ref{fig:DB} und
\ref{code:core.models.py}) gespeichert. Die Objekte werden keinem User
zugeordnet gespeichert, sondern dynamisch berechnet, wer welche Achievements
hat.

Es gibt 3 verschiedene Kategorien von Achievements.
\begin{itemize}
    \item Karma basiert (siehe \ref{spez:Karma})
    \item Images basiert (siehe \ref{spez:Images})
    \item Review basiert (siehe \ref{spez:Reviews})
\end{itemize}

Wenn man ein besseres Achievements in einer Kategorie erreicht, dann wird das
das neue Achievement. Man kann auch wieder Achievements wieder verlieren.

Karma basiert heisst, man bekommt ein Achievment in dieser Kategorie, wenn man
ein eine bestimmte Menge an Karma überschritten hat.

Image und Review basiert heisst, dass man eine bestimmte Anzahl an most liked
Images/Reviews in einem MenuType (siehe \ref{spez:Menus}) hat.

Man kann alle Achievements im Profil anschauen (siehe \ref{code:core.views.py})

\section{Deployment} \label{spez:Deployment}

Die Webseite wird auf einem Heroku Eco Dyno gehostet. Die Datenbank wird auch
von Heroku auf einem Postgres Server gehostet. Die Bilder werden auf einem
Google Drive gespeichert (siehe \ref{spez:Images}).
