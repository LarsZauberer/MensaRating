{% extends "base.html" %}
{% load static %}

{% block import %}
{% endblock %}

{% block content %}
{% if messages %}
{% for i in messages %}
{% autoescape off %}
{% if i.tags == "error" %}
    <div class="alert error">
        <span class="closebtn" onclick="closeAlert(this.parentElement);">&times;</span>
        {{i}}
    </div>
{% else %}
    <div class="alert success">
        <span class="closebtn" onclick="closeAlert(this.parentElement);">&times;</span>
        {{i}}
    </div>
{% endif %}
{% endautoescape %}
{% endfor %}
{% endif %}

<main id="menu">



    <h1>
        {{menu.name}}   

        <span>  </span>
        <span id="date">&nbsp;&ndash; {{menu.date}}</span>
        {% if menu.vegetarian %}
        <img class="vegivegan-label" src="{% static 'images/vegetarian.png' %}" alt="vegetarian">
        {% elif menu.vegan %}
        <img class="vegivegan-label" src="{% static 'images/vegan.png' %}" alt="vegan">
        {% endif %} 

    </h1>

    <div style="margin-bottom: 2em;">{{menu.description}}</div>
    <!-- https://www.w3schools.com/howto/howto_js_slideshow.asp -->
    <div class="imageContainer">
        {% for image in images %}
            <div class="imageSlide fade">
                <p class="userName imageUserText">{{image.profil.user.username}}#{{image.profil.karma}}</p>
                <div class="imgContainer">
                    <img src="{{image.image.url}}" alt="{{image.image.name}}" class="imageImage">
                </div>
                <div class="imageButtons">
                    {% if today %}
                    <form method="post" enctype="multipart/form-data" style="margin-right: 1em">
                        {% csrf_token %}
                        {{ imageForm }}
                        <button type="submit">Post</button>
                    </form>
                    <button class="like-btn imageLike" onclick="like(2, {{image.pk}})" id="2-{{image.pk}}-btn">Like</button>
                    {% endif %}
        
                    <p class="likeText imageLikeText">Likes: <span id="2-{{image.pk}}">{{image.likes}}</span></p>
                </div>
            </div>
        {% endfor %}
        {% if images|length == 0 %}
            <div class="imageSlide fade">
                <div class="imgContainer">
                    <img src="{% static 'images/no_images_yet.png' %}" alt="Keine Bilder verfÃ¼gbar" class="imageImage">
                </div>
            </div>
        {% else %}
            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
            <a class="next" onclick="plusSlides(1)">&#10095;</a>
        {% endif %}
    </div>

    

    
    {% if today %}
    
        <div class="give-star-rating">
            <form method="post">
                {% csrf_token %}
                <div class="give-stars">
                    <button type="submit" value="1" name="rating" class="give-star" onclick="change_cursor_wait();"></button>
                    <button type="submit" value="2" name="rating" class="give-star" onclick="change_cursor_wait();"></button>
                    <button type="submit" value="3" name="rating" class="give-star" onclick="change_cursor_wait();"></button>
                    <button type="submit" value="4" name="rating" class="give-star" onclick="change_cursor_wait();"></button>
                    <button type="submit" value="5" name="rating" class="give-star" onclick="change_cursor_wait();"></button>
                </div>
            </form>
            </div>
        </div>

        <script>
            stars = document.getElementsByClassName("give-star")
            for(let i = 0; i < stars.length; i++){
                stars[i].addEventListener("mouseover", function(){starHover(stars, i)})
                stars[i].addEventListener("mouseout", function(){stopStarHover()})
            }



        </script>
    {% endif%}


  
    <div class="rating">
        <div>{{rating}}</div>
            
        <div class="stars">
            <div class="emptystars"></div>
            <div id="stars-0" class="fullstars"></div>
            <div class="starshape"></div>
        </div>

        <div>({{numRates}})</div>
    </div>
    

    
    





    <h3><a href="{% url 'menuType' menu.menuType.pk %}">Vergleiche das Essen</a></h3>


    <div id="reviews">

        {% if today %}
            <h2>
                Reviews
            </h2>
            <form id="review-text" method="post">
                {% csrf_token %}
                {{ reviewForm }}
                <button type="submit">Post</button>
            </form>
        {% else %}
            <h2>
                Reviews
            </h2>
        {% endif %}



        {% for review in reviews %}
        <div class="review">
            <div class="review-header">
                <div>{{review.profil.user.username}}</div>
                <div>{{review.profil.karma}}</div>
                <div>Rating</div>
                {% if today %}
                <button onclick="like(1, {{review.pk}})" id="1-{{review.pk}}-btn" class="like-btn">Like</button>
                {% endif %}
                <div>Likes: <span id="1-{{review.pk}}">{{review.likes}}</span></div>
            </div>
            {{review.text}}
        </div>
        {% endfor %}
    </div>


    

    <script data-rating="{{rating}}">
        data = document.currentScript.dataset;
        starRate(0, data.rating)
        checkOrientation()
        showSlides(slideIndex);
    </script>

    

    {% if messages %}
    {% for i in messages %}
    {% autoescape off %}
    {% if i.tags == "error" %}
    <div role="alert" class="alert error"><span>{{i}}</span></div>
    {% else %}
    <div role="alert" class="alert success"><span>{{i}}</span></div>
    {% endif %}
    {% endautoescape %}
    {% endfor %}
    {% endif %}

    


    

</main>

{% endblock %}